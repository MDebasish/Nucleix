---
title: "Learning S4 in R with Example"
author: "Dr. Debasish Mukherjee"
date: "`r Sys.Date()`"
output: 
  html_document: 
    pandoc_args: ["--lua-filter=color-text.lua"]
    toc: true
    toc_float: true
  pdf_document: 
    pandoc_args: ["--lua-filter=color-text.lua"]
    keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{cat, engine.opts = list(file = "color-text.lua")}
Span = function(el)
  color = el.attributes['color']
  -- if no color attribute, return unchange
  if color == nil then return el end
  
  -- transform to <span style="color: red;"></span>
  if FORMAT:match 'html' then
    -- remove color attributes
    el.attributes['color'] = nil
    -- use style attribute instead
    el.attributes['style'] = 'color: ' .. color .. ';'
    -- return full span element
    return el
  elseif FORMAT:match 'latex' then
    -- remove color attributes
    el.attributes['color'] = nil
    -- encapsulate in latex code
    table.insert(
      el.content, 1,
      pandoc.RawInline('latex', '\\textcolor{'..color..'}{')
    )
    table.insert(
      el.content,
      pandoc.RawInline('latex', '}')
    )
    -- returns only span content
    return el.content
  else
    -- for other format return unchanged
    return el
  end
end
```

---

```{=html}
<script>
$(document).ready(function(){
  $('span:nth-child(2n-1)').css("color",function(i,col) {
    $("blockquote").eq(i).css({"border-left":" 5px solid " + col,
                               "font-style":"italic",
                               "background-color": "#f5f5f5"});
  });
});
</script>

<style>
.nav-pills>li:nth-child {
    background: green;
 }
 </style>
```


# Introduction {.tabset .tabset-fade .tabset-pills}

---

To work with OOP in `R` and specially with `S4` we need to follow some guidelines.
This is by no means a complete guide rather a bare minimum structure which helps
to get going. I have prepared this solely for my won understanding. Any suggestion
for modification or inclusion will be highly appreciated. 



## Help

This is the format used throughout this documents for helpful comments:



> [&#128466; ***Source***]{color="#89CFF0"}  
> (https://www.compart.com/en/unicode/) 


> [&#128712; **Note !**]{color="#0096FF"}  
> Useful information that users should know, even when skimming content..


> [&#128161; **Tip !**]{color="#228B22"}  
> Helpful advice for doing things better or more easily
    
> [&#128492; **Important !**]{color="#7F00FF"}  
> Key information users need to know to achieve their goal. 

> [&#9888; **Warning !**]{color="#E49B0F"}  
> Urgent info that needs immediate user attention to avoid problems. 

> [&#10060; **Caution !**]{color="#DC143C"}  
> Advises about risks or negative outcomes of certain actions.

## R Class
```{r}
# ================
# Class definition
# ================
setClass("ParentClass1")
setClass("ClassName",
          slots = list(
            x = "numeric",
            y = "character"
          ),
          contains = "ParentClass1"
)
setClass("ClassName2",
         slots = list(
           x = "numeric",
           y = "character",
           z = "numeric"
         ),
         contains = "ParentClass1"
)
```

## Constructors


```{r}
# ===========
# Constructor
# ===========

CNcreator <- function(x,y,...)
  new("ClassName",x=x,y=y)
```

## Getters

```{r}
# ===========
# Getters
# ===========

setGeneric("MethodName",
            function(x, y, ...) standardGeneric("MethodName"))


setMethod(f="MethodName",
           signature = "ClassName",
           definition = function(x, y, ...) {
             return(paste0(x@x,x@y))
           }
)
setMethod(
  f="MethodName",
  signature = "ClassName2",
  definition = function(x, y, z, ...) {
    return(paste0(x@x,x@y,x@z))
    }
)
```

## Show Methods

```{r}
# ===========
# show method
#============
setMethod("show", "ClassName",
           function(object)
             cat(class(object), "instance with", length(object),
                   "list and elements are", MethodName(object), "\n")
           )

```

## Validity

```{r}
# ===============
# validity method
#================
setValidity("ClassName",
            function(object){
              if (!is.integer(object@x) || !is.character(object@y)) {
                return("first Slot should be Interger and seconf character\n")
              }
              slot_lengths <- c(length(slot(object,"x")),
                                length(slot(object,"y")))
              if (length(unique(slot_lengths)) != 1)
                return("lengths of slots 'x', and 'y' differ")
              TRUE
            })

```

## Use

```{r}
aa <- CNcreator(1:10,LETTERS[1:10])

bb <- new("ClassName2",x=c(1:10),y=c(LETTERS[1:10]), z=10:30)

MethodName(aa)
MethodName(bb)

isS4(aa)

# Class defination
showClass("ClassName")

# Show all the methods for the specified function(s) or class
showMethods(MethodName)

# show associated generic methods with the class
attr(methods(class="ClassName"), "info")$generic
```




# References

---
- https://bioconductor.org/packages/devel/bioc/vignettes/S4Vectors/inst/doc/S4QuickOverview.pdf
- https://www.bioconductor.org/help/course-materials/2017/Zurich/S4-classes-and-methods.html
- https://kasperdanielhansen.github.io/genbioconductor/html/R_S4.html
- https://quarto.org/docs/authoring/callouts.html

